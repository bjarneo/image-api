<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Processing API Demo</title>
    <style>
      :root {
        --bg-color: #fff;
        --text-color: #000;
        --border-color: #eaeaea;
        --input-bg: #fafafa;
        --button-bg: #000;
        --button-text: #fff;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
          "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans",
          "Helvetica Neue", sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        line-height: 1.6;
        margin: 0;
        padding: 0;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 40px 20px;
      }

      h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 2rem;
      }

      form {
        display: grid;
        gap: 1.5rem;
      }

      fieldset {
        border: 1px solid var(--border-color);
        border-radius: 5px;
        padding: 1rem;
      }

      legend {
        font-weight: 600;
        padding: 0 0.5rem;
      }

      label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
      }

      input[type="file"],
      input[type="number"],
      select {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid var(--border-color);
        border-radius: 5px;
        background-color: var(--input-bg);
        font-size: 1rem;
      }

      button {
        background-color: var(--button-bg);
        color: var(--button-text);
        border: none;
        border-radius: 5px;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: opacity 0.2s ease;
      }

      button:hover {
        opacity: 0.8;
      }

      #result {
        margin-top: 2rem;
      }

      #result img {
        max-width: 100%;
        height: auto;
        border-radius: 5px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      #result p {
        margin: 0.5rem 0;
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Image Processing API Demo</h1>
      <form id="imageForm">
        <div>
          <label for="imageInput">Upload Image</label>
          <input type="file" id="imageInput" accept="image/*" required />
        </div>
        <div>
          <label for="rotate">Rotate (degrees)</label>
          <input type="number" id="rotate" min="0" max="360" />
        </div>
        <fieldset>
          <legend>Resize</legend>
          <div>
            <label for="resizeWidth">Width</label>
            <input type="number" id="resizeWidth" min="1" />
          </div>
          <div>
            <label for="resizeHeight">Height</label>
            <input type="number" id="resizeHeight" min="1" />
          </div>
          <div>
            <label for="resizeFit">Fit</label>
            <select id="resizeFit">
              <option value="cover">Cover</option>
              <option value="contain">Contain</option>
              <option value="fill">Fill</option>
              <option value="inside">Inside</option>
              <option value="outside">Outside</option>
            </select>
          </div>
        </fieldset>
        <fieldset>
          <legend>Crop</legend>
          <div>
            <label for="cropLeft">Left</label>
            <input type="number" id="cropLeft" min="0" />
          </div>
          <div>
            <label for="cropTop">Top</label>
            <input type="number" id="cropTop" min="0" />
          </div>
          <div>
            <label for="cropWidth">Width</label>
            <input type="number" id="cropWidth" min="1" />
          </div>
          <div>
            <label for="cropHeight">Height</label>
            <input type="number" id="cropHeight" min="1" />
          </div>
        </fieldset>
        <div>
          <label for="format">Format</label>
          <select id="format">
            <option value="">Original</option>
            <option value="jpeg">JPEG</option>
            <option value="png">PNG</option>
            <option value="webp">WebP</option>
            <option value="avif">AVIF</option>
            <option value="gif">GIF</option>
          </select>
        </div>
        <div>
          <label for="quality">Quality</label>
          <input type="number" id="quality" min="1" max="100" value="80" />
        </div>
        <button type="submit">Process Image</button>
      </form>
      <div id="result"></div>
    </div>

    <script>
      const API_URL = "http://localhost:3003";

      document
        .getElementById("imageForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData();

          const imageFile = document.getElementById("imageInput").files[0];
          formData.append("image", imageFile);

          const rotate = document.getElementById("rotate").value;
          if (rotate) formData.append("rotate", rotate);

          const resizeWidth = document.getElementById("resizeWidth").value;
          const resizeHeight = document.getElementById("resizeHeight").value;
          const resizeFit = document.getElementById("resizeFit").value;
          if (resizeWidth || resizeHeight) {
            const resize = { fit: resizeFit };
            if (resizeWidth) resize.width = parseInt(resizeWidth);
            if (resizeHeight) resize.height = parseInt(resizeHeight);
            formData.append("resize", JSON.stringify(resize));
          }

          const cropLeft = document.getElementById("cropLeft").value;
          const cropTop = document.getElementById("cropTop").value;
          const cropWidth = document.getElementById("cropWidth").value;
          const cropHeight = document.getElementById("cropHeight").value;
          if (cropLeft && cropTop && cropWidth && cropHeight) {
            formData.append(
              "crop",
              JSON.stringify({
                left: parseInt(cropLeft),
                top: parseInt(cropTop),
                width: parseInt(cropWidth),
                height: parseInt(cropHeight),
              }),
            );
          }

          const format = document.getElementById("format").value;
          if (format) formData.append("format", format);

          const quality = document.getElementById("quality").value;
          if (quality) formData.append("quality", quality);

          try {
            const response = await fetch(`${API_URL}/image`, {
              method: "POST",
              body: formData,
            });

            if (!response.ok) {
              throw new Error("Image processing failed");
            }

            const result = await response.json();
            const resultDiv = document.getElementById("result");
            resultDiv.innerHTML = `
                    <h2>Processed Image</h2>
                    <img src="${API_URL}/image/${result.image}" alt="Processed image">
                    <p>Width: ${result.width}px</p>
                    <p>Height: ${result.height}px</p>
                    <p>Size: ${result.size} bytes</p>
                    <p>Format: ${result.format}</p>
                `;
          } catch (error) {
            console.error("Error:", error);
            alert("An error occurred while processing the image.");
          }
        });
    </script>
  </body>
</html>
